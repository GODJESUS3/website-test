<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced 3D Website</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            touch-action: none;
        }
        canvas {
            display: block;
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-family: sans-serif;
            font-size: 1.2em;
        }
        .nav-item {
            cursor: pointer;
            margin-right: 15px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .nav-item:hover, .nav-item.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="ui">
        <span class="nav-item active" data-section="podcast">PODCAST</span>
        <span class="nav-item" data-section="store">STORE</span>
        <span class="nav-item" data-section="blog">BLOG</span>
        <span class="nav-item" data-section="glass">GLASS</span>
    </div>
    
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>

    <script type="module">
        import * as THREE from './lib/three.module.js';
        import * as CANNON from './lib/cannon-es.js';

        class Interactive3DWebsite {
            constructor() {
                this.initThree();
                this.initCannon();
                this.createWebsiteModel();
                this.setupInteractions();
                this.setupUI();
                this.animate();
            }

            initThree() {
                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x000000);
                this.clock = new THREE.Clock();

                // Camera
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
                this.camera.position.z = 10;

                // Renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true 
                });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                document.body.appendChild(this.renderer.domElement);
            }

            initCannon() {
                // World
                this.world = new CANNON.World();
                this.world.gravity.set(0, 0, 0); // No gravity
                this.world.broadphase = new CANNON.NaiveBroadphase();
                this.world.solver.iterations = 10;

                // Materials
                this.physicsMaterials = {
                    website: new CANNON.Material('websiteMaterial'),
                    default: new CANNON.Material('defaultMaterial')
                };
                const contactMaterial = new CANNON.ContactMaterial(
                    this.physicsMaterials.website, 
                    this.physicsMaterials.default, 
                    { friction: 0.4, restitution: 0.7 }
                );
                this.world.addContactMaterial(contactMaterial);
            }

            createWebsiteModel() {
                // Main group
                this.websiteModel = new THREE.Group();
                this.scene.add(this.websiteModel);

                // Volumetric body (as base)
                this.createMainBody();

                // Section content maps
                this.sectionContentMaps = {
                    podcast: this.createContentMap('Podcast Content'),
                    store: this.createContentMap('Store Content'),
                    blog: this.createContentMap('Blog Content'),
                    glass: this.createContentMap('Glass Content')
                };

                // Visible face display
                this.sectionDisplayMaterial = new THREE.MeshPhysicalMaterial({
                    map: this.sectionContentMaps.podcast, // Initial content
                    side: THREE.DoubleSide,
                    transmission: 0.2, // See-through effect
                    roughness: 0.2,
                    metalness: 0.1,
                    clearcoat: 1,
                    clearcoatRoughness: 0.1,
                    thickness: 1.0
                });
                this.createDisplayFace(this.sectionDisplayMaterial);

                // Add physics to entire model
                this.createPhysicsBody();
            }

            createMainBody() {
                // Create 3D shape (base of website)
                const bodyGeometry = new THREE.BoxGeometry(8, 10, 1.5, 32, 32, 4);
                this.bodyMaterial = new THREE.MeshPhysicalMaterial({
                    color: 0x111122,
                    emissive: 0x222244,
                    emissiveIntensity: 0.7,
                    transmission: 0.2, // See-through
                    roughness: 0.25,
                    metalness: 0.05,
                    clearcoat: 0.5,
                    clearcoatRoughness: 0.1,
                    side: THREE.DoubleSide
                });

                this.mainBody = new THREE.Mesh(bodyGeometry, this.bodyMaterial);
                this.websiteModel.add(this.mainBody);

                // Add edge wireframe highlight
                const edges = new THREE.EdgesGeometry(bodyGeometry, 15);
                const wireframeMaterial = new THREE.LineBasicMaterial({ 
                    color: 0x88ffff, 
                    transparent: true, 
                    opacity: 0.6, 
                    linewidth: 2 
                });
                const wireframe = new THREE.LineSegments(edges, wireframeMaterial);
                this.mainBody.add(wireframe);

            }

            createDisplayFace(material) {
                // Create 2D surface to display active content on
                const faceGeometry = new THREE.PlaneGeometry(7, 9);
                this.displayFace = new THREE.Mesh(faceGeometry, material);
                this.displayFace.position.z = 0.76; // Just in front
                this.websiteModel.add(this.displayFace);
            }

            createContentMap(text) {
                // Create dynamic texture for each "section" (podcast, store, etc.)
                const canvas = document.createElement('canvas');
                canvas.width = 512;
                canvas.height = 512;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#333'; // Black backdrop
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.font = '60px sans-serif';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);
                return new THREE.CanvasTexture(canvas);
            }

            setActiveSection(section) {
                // Change active face display
                if (this.activeSection === section) return; // Nothing to do
                this.activeSection = section;

                // Transition new map
                const map = this.sectionContentMaps[section];
                gsap.to(this.sectionDisplayMaterial, { // GSAP used here
                    map: map, // Change content
                    duration: 0.4 // Cross-fade effect
                });
            }

            createPhysicsBody() {
                 // Physical representation
                 const halfExtents = new CANNON.Vec3(4, 5, 0.75);
                 this.websiteBody = new CANNON.Body({
                    mass: 2,
                    shape: new CANNON.Box(halfExtents),
                    material: this.physicsMaterials.website,
                    linearDamping: 0.1,
                    angularDamping: 0.3
                });

                 this.world.addBody(this.websiteBody);

            }

            setupInteractions() {
                // Track drag state
                this.isDragging = false;
                this.previousPosition = new THREE.Vector2();

                 // Events
                 this.renderer.domElement.addEventListener('mousedown', (e) => this.onDragStart(e));
                 this.renderer.domElement.addEventListener('touchstart
